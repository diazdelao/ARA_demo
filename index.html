<!doctype html><meta charset="utf-8">
<title>Graph Filtration</title>
<script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>

<div id="graph" style="width:100%;height:620px"></div>

<script>
fetch("ec_payload.json?v=4").then(r=>r.json()).then(D=>{
  const T  = D.thresholds;
  const Gs = D.graphs;
  const fmt = t => (Math.abs(t) >= 1 ? t.toFixed(1) : t.toFixed(3));

  // Frames: two traces per frame (edges, nodes)
  const frames = Gs.map((g,i)=>({
    name: String(i),
    data: [
      { x: g.edgeX, y: g.edgeY },                          // edges
      { x: g.nodeX, y: g.nodeY, marker: { size: 6 } }      // nodes
    ]
  }));

  // Initial traces
  const data = [
    { type:'scattergl', mode:'lines',   x:Gs[0].edgeX, y:Gs[0].edgeY, line:{width:1} },
    { type:'scattergl', mode:'markers', x:Gs[0].nodeX, y:Gs[0].nodeY, marker:{size:6} }
  ];

  // Layout with a single slider that drives frames
  const layout = {
    title: 'Graph at threshold τ',
    xaxis: { visible:false },
    yaxis: { visible:false, scaleanchor:'x' },
    margin:{ l:10, r:10, t:40, b:10 },
    updatemenus:[{
      type:'buttons',
      buttons:[{ label:'Play', method:'animate',
        args:[null,{ fromcurrent:true, frame:{duration:0, redraw:true}, transition:{duration:0} }] }],
      x:0.02, y:1.12
    }],
    sliders:[{
      pad:{ t:20 },
      currentvalue:{ prefix:'τ = ' },
      steps: T.map((t,i)=>({
        label: fmt(t),
        method:'animate',
        args:[[String(i)], { mode:'immediate', frame:{ duration:0, redraw:true }, transition:{ duration:0 } }]
      }))
    }]
  };

  Plotly.newPlot('graph', data, layout).then(()=>{
    Plotly.addFrames('graph', frames);
  });
});
</script>